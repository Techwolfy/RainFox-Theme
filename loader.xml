<?xml version="1.0"?>

<bindings id="generalBindings"
	xmlns="http://www.mozilla.org/xbl"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
	xmlns:xbl="http://www.mozilla.org/xbl">

	<binding id="js" extends="chrome://global/content/bindings/toolbarbutton.xml#menu">
		<implementation>
			<constructor>
				<![CDATA[

					if(window.ucjsLoaded) return;
					window.ucjsLoaded = true;

					var sss = Cc['@mozilla.org/content/style-sheet-service;1'].getService(Ci.nsIStyleSheetService);

					function load(dir) {
						while(dir.hasMoreElements()) {
							var file = dir.getNext().QueryInterface(Ci.nsIFile);
							var fileURI = Services.io.newFileURI(file);

							if(file.isFile()) {
								if(/.js$/i.test(file.leafName)) {
									Services.scriptloader.loadSubScriptWithOptions(fileURI.spec, {target: window, ignoreCache: true});
								} else if(/\.as\.css$/i.test(file.leafName)) {
									if(!sss.sheetRegistered(fileURI, sss.AGENT_SHEET)) {
										sss.loadAndRegisterSheet(fileURI, sss.AGENT_SHEET);
									}
								}
							} else if(file.isDirectory()) {
								load(file.directoryEntries);
							}
						}
					}

					load(FileUtils.getDir("UChrm", []).directoryEntries);

				]]>
			</constructor>
		</implementation>
	</binding>
</bindings>
